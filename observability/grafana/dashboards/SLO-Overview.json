{
  "annotations": {"list": []},
  "editable": true,
  "graphTooltip": 0,
  "panels": [
    { "type": "row", "title": "SLO Summary", "gridPos": {"h":1,"w":24,"x":0,"y":0} },
    {
      "type": "stat",
      "title": "Global Availability (5m)",
      "gridPos": {"h":5, "w":8, "x":0, "y":1},
      "datasource": {"type":"prometheus","uid":"prometheus"},
      "fieldConfig": {"defaults": {"unit":"percentunit"}},
      "targets": [
        {"expr": "1 - (sum(rate(traces_spanmetrics_calls_total{status_code!=\\\"STATUS_CODE_OK\\\"}[5m])) / sum(rate(traces_spanmetrics_calls_total[5m])))", "refId": "A"}
      ]
    },
    {
      "type": "stat",
      "title": "Services Above p95 Latency SLO (500ms)",
      "gridPos": {"h":5, "w":8, "x":8, "y":1},
      "datasource": {"type":"prometheus","uid":"prometheus"},
      "targets": [
        {"expr": "count(histogram_quantile(0.95, sum by (le, service_name) (rate(traces_spanmetrics_duration_milliseconds_bucket[5m]))) > 500)", "refId":"A"}
      ]
    },
    {
      "type": "stat",
      "title": "Services Above Error Budget (5%)",
      "gridPos": {"h":5, "w":8, "x":16, "y":1},
      "datasource": {"type":"prometheus","uid":"prometheus"},
      "targets": [
        {"expr": "count((sum by(service_name)(rate(traces_spanmetrics_calls_total{status_code!=\\\"STATUS_CODE_OK\\\"}[5m])) / sum by(service_name)(rate(traces_spanmetrics_calls_total[5m]))) > 0.05)", "refId":"A"}
      ]
    },
    { "type": "row", "title": "Per Service SLOs", "gridPos": {"h":1,"w":24,"x":0,"y":6} },
    {
      "type": "timeseries",
      "title": "Availability by Service (5m)",
      "gridPos": {"h":8, "w":12, "x":0, "y":7},
      "datasource": {"type":"prometheus","uid":"prometheus"},
      "fieldConfig": {"defaults": {"unit":"percentunit", "thresholds":{"mode":"absolute","steps":[{"color":"green","value":0},{"color":"red","value":0.995}]}}},
      "targets": [
        {"expr": "1 - (sum by(service_name)(rate(traces_spanmetrics_calls_total{status_code!=\\\"STATUS_CODE_OK\\\"}[5m])) / sum by(service_name)(rate(traces_spanmetrics_calls_total[5m])))", "legendFormat": "{{service_name}}", "refId":"A"}
      ]
    },
    {
      "type": "timeseries",
      "title": "p95 Latency by Service (ms)",
      "gridPos": {"h":8, "w":12, "x":12, "y":7},
      "datasource": {"type":"prometheus","uid":"prometheus"},
      "fieldConfig": {"defaults": {"unit":"ms", "thresholds":{"mode":"absolute","steps":[{"color":"green","value":0},{"color":"red","value":500}]}}},
      "targets": [
        {"expr": "histogram_quantile(0.95, sum by (le, service_name) (rate(traces_spanmetrics_duration_milliseconds_bucket[5m])))", "legendFormat": "{{service_name}}", "refId":"A"}
      ]
    },
    { "type": "row", "title": "Route Latency", "gridPos": {"h":1,"w":24,"x":0,"y":15} },
    {
      "type": "timeseries",
      "title": "p95 Latency by Route (ms)",
      "gridPos": {"h":8, "w":24, "x":0, "y":16},
      "datasource": {"type":"prometheus","uid":"prometheus"},
      "fieldConfig": {"defaults": {"unit":"ms", "thresholds":{"mode":"absolute","steps":[{"color":"green","value":0},{"color":"red","value":500}]}}},
      "targets": [
        {"expr": "histogram_quantile(0.95, sum by (le, service_name, http_route) (rate(traces_spanmetrics_duration_milliseconds_bucket[5m])))", "legendFormat": "{{service_name}} {{http_route}}", "refId":"A"}
      ]
    }
    , { "type": "row", "title": "Route Burn Rate & Budget", "gridPos": {"h":1,"w":24,"x":0,"y":36} }
    , {
      "type": "timeseries",
      "title": "Burn Rate (5m) by Route",
      "gridPos": {"h":8, "w":12, "x":0, "y":37},
      "datasource": {"type":"prometheus","uid":"prometheus"},
      "fieldConfig": {"defaults": {"unit":"ratio"}},
      "targets": [
        {"expr": "route:error_rate:ratio_rate5m{http_route!~\"^/(health|metrics)(/.*)?$\"}", "legendFormat": "{{service_name}} {{http_route}}", "refId":"A"}
      ]
    }
    , {
      "type": "timeseries",
      "title": "Error Budget Remaining (5m) by Route",
      "gridPos": {"h":8, "w":12, "x":12, "y":37},
      "datasource": {"type":"prometheus","uid":"prometheus"},
      "fieldConfig": {"defaults": {"unit":"percentunit"}},
      "targets": [
        {"expr": "clamp_min(1 - (route:error_rate:ratio_rate5m{http_route!~\"^/(health|metrics)(/.*)?$\"} / 0.005), 0)", "legendFormat": "{{service_name}} {{http_route}}", "refId":"A"}
      ]
    }
    , { "type": "row", "title": "Error Budget & Burn Rate", "gridPos": {"h":1,"w":24,"x":0,"y":24} }
    , {
      "type": "stat",
      "title": "Fast Burn Breaches (5m > 14x budget)",
      "gridPos": {"h":5, "w":8, "x":0, "y":25},
      "datasource": {"type":"prometheus","uid":"prometheus"},
      "targets": [
        {"expr": "count(service:error_rate:ratio_rate5m > (14 * 0.005))", "refId":"A"}
      ]
    }
    , {
      "type": "stat",
      "title": "Slow Burn Breaches (1h > 6x budget)",
      "gridPos": {"h":5, "w":8, "x":8, "y":25},
      "datasource": {"type":"prometheus","uid":"prometheus"},
      "targets": [
        {"expr": "count((sum by(service_name)(rate(traces_spanmetrics_calls_total{status_code!=\\\"STATUS_CODE_OK\\\"}[1h])) / clamp_min(sum by(service_name)(rate(traces_spanmetrics_calls_total[1h])), 1e-9)) > (6 * 0.005))", "refId":"A"}
      ]
    }
    , {
      "type": "timeseries",
      "title": "Burn Rate (5m) by Service",
      "gridPos": {"h":8, "w":8, "x":16, "y":25},
      "datasource": {"type":"prometheus","uid":"prometheus"},
      "fieldConfig": {"defaults": {"unit":"ratio"}},
      "targets": [
        {"expr": "service:error_rate:ratio_rate5m", "legendFormat": "{{service_name}}", "refId":"A"}
      ]
    }
    , {
      "type": "timeseries",
      "title": "Error Budget Remaining (5m) by Service",
      "gridPos": {"h":8, "w":12, "x":0, "y":30},
      "datasource": {"type":"prometheus","uid":"prometheus"},
      "fieldConfig": {"defaults": {"unit":"percentunit"}},
      "targets": [
        {"expr": "clamp_min(1 - (service:error_rate:ratio_rate5m / 0.005), 0)", "legendFormat": "{{service_name}}", "refId":"A"}
      ]
    }
    , {
      "type": "stat",
      "title": "Avg Error Budget Remaining (5m)",
      "gridPos": {"h":5, "w":12, "x":12, "y":30},
      "datasource": {"type":"prometheus","uid":"prometheus"},
      "fieldConfig": {"defaults": {"unit":"percentunit"}},
      "targets": [
        {"expr": "avg(clamp_min(1 - (service:error_rate:ratio_rate5m / 0.005), 0))", "refId":"A"}
      ]
    }
  ],
  "refresh": "30s",
  "schemaVersion": 39,
  "style": "dark",
  "tags": ["systemupdate", "slo"],
  "time": {"from":"now-6h","to":"now"},
  "title": "SLO Overview",
  "uid": "slo-overview"
}
