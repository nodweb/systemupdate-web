_format_version: "3.0"
_transform: true

services:
  - name: auth-service
    url: http://auth-service:8001
    routes:
      - name: auth-route
        paths: ["/auth"]
        strip_path: true
        plugins:
          - name: cors
            config:
              origins: ["https://app.example.com"]
              methods: [GET, POST, PUT, PATCH, DELETE, OPTIONS]
              headers: [Accept, Authorization, Content-Type]
              exposed_headers: [Link]
              credentials: true
              max_age: 600

  - name: device-service
    url: http://device-service:8003
    routes:
      - name: device-route
        paths: ["/devices"]
        strip_path: false
        plugins:
          - name: cors
            config:
              origins: ["https://app.example.com"]
              methods: [GET, POST, PUT, PATCH, DELETE, OPTIONS]
              headers: [Accept, Authorization, Content-Type]
              exposed_headers: [Link]
              credentials: true
              max_age: 600

  - name: command-service
    url: http://command-service:8004
    routes:
      - name: command-route
        paths: ["/commands"]
        strip_path: false
        plugins:
          - name: cors
            config:
              origins: ["https://app.example.com"]
              methods: [GET, POST, PUT, PATCH, DELETE, OPTIONS]
              headers: [Accept, Authorization, Content-Type]
              exposed_headers: [Link]
              credentials: true
              max_age: 600

  - name: ingest-service
    url: http://data-ingest-service:8005
    routes:
      - name: ingest-http
        paths: ["/ingest"]
        strip_path: false
        plugins:
          - name: cors
            config:
              origins: ["https://app.example.com"]
              methods: [GET, POST, PUT, PATCH, DELETE, OPTIONS]
              headers: [Accept, Authorization, Content-Type]
              exposed_headers: [Link]
              credentials: true
              max_age: 600

  - name: analytics-service
    url: http://analytics-service:8006
    routes:
      - name: analytics-route
        paths: ["/analytics"]
        strip_path: true
        plugins:
          - name: cors
            config:
              origins: ["https://app.example.com"]
              methods: [GET, POST, PUT, PATCH, DELETE, OPTIONS]
              headers: [Accept, Authorization, Content-Type]
              exposed_headers: [Link]
              credentials: true
              max_age: 600

  - name: notification-service
    url: http://notification-service:8007
    routes:
      - name: notif-route
        paths: ["/notify"]
        strip_path: true
        plugins:
          - name: cors
            config:
              origins: ["https://app.example.com"]
              methods: [GET, POST, PUT, PATCH, DELETE, OPTIONS]
              headers: [Accept, Authorization, Content-Type]
              exposed_headers: [Link]
              credentials: true
              max_age: 600

plugins:
  - name: rate-limiting
    config:
      minute: 120
      policy: local
  # Placeholder JWT plugin (disabled). Configure consumers/keys or OIDC plugin before enabling.
  - name: jwt
    enabled: false
    config:
      claims_to_verify: [exp]
      key_claim_name: kid
      run_on_preflight: false
